var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,i){void 0===i&&(i=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,i,r)}:function(e,t,o,i){void 0===i&&(i=o),e[i]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t},__awaiter=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(r,n){function s(e){try{l(i.next(e))}catch(e){n(e)}}function a(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define(["require","exports","./theme","./compilerOptions","./vendor/lzstring.min","./release_data","./getInitialCode","./twoslashSupport","./vendor/typescript-vfs","./vendor/ata/index"],(function(e,t,o,i,r,n,s,a,l,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTypeScriptSandbox=t.defaultPlaygroundSettings=void 0,r=__importDefault(r),l=__importStar(l);const c=navigator&&/android/i.test(navigator.userAgent),d={scrollBeyondLastLine:!0,scrollBeyondLastColumn:3,minimap:{enabled:!1},lightbulb:{enabled:!0},quickSuggestions:{other:!c,comments:!c,strings:!c},acceptSuggestionOnCommitCharacter:!c,acceptSuggestionOnEnter:c?"off":"on",accessibilitySupport:c?"off":"on",inlayHints:{enabled:!0}};function u(){return{text:"",domID:"",compilerOptions:{},acquireTypes:!0,filetype:"ts",supportTwoslashCompilerOptions:!1,logger:console}}t.defaultPlaygroundSettings=u,t.createTypeScriptSandbox=(e,t,c)=>{const g=Object.assign(Object.assign({},u()),e);if(!("domID"in g)&&!("elementToAppend"in g))throw new Error("You did not provide a domID or elementToAppend");const m=g.suppressAutomaticallyGettingDefaultText?g.text:(0,s.getInitialCode)(g.text,document.location),f=(0,i.getDefaultSandboxCompilerOptions)(g,t);let y;if(g.suppressAutomaticallyGettingCompilerFlags)y=f;else{const e=new URLSearchParams(location.search);let t=(0,i.getCompilerOptionsFromParams)(f,c,e);Object.keys(t).length&&g.logger.log("[Compiler] Found compiler options in query params: ",t),y=Object.assign(Object.assign({},f),t)}const h="js"===g.filetype;h&&(y.allowJs=!0);const v=(e=>"js"===e.filetype?"javascript":"typescript")(g),_=function(e,t,o){return o.Uri.file(function(e,t,o){return"input."+(t.jsx!==o.languages.typescript.JsxEmit.None&&"d.ts"!==e.filetype?e.filetype+"x":e.filetype)}(e,t,o))}(g,y,t),O="domID"in g?document.getElementById(g.domID):g.elementToAppend,S=t.editor.createModel(m,v,_);t.editor.defineTheme("sandbox",o.sandboxTheme),t.editor.defineTheme("sandbox-dark",o.sandboxThemeDark),t.editor.setTheme("sandbox");const b=Object.assign({model:S},d,g.monacoSettings||{}),C=t.editor.create(O,b),T=h?t.languages.typescript.getJavaScriptWorker:t.languages.typescript.getTypeScriptWorker,j=h?t.languages.typescript.javascriptDefaults:t.languages.typescript.typescriptDefaults;g.customTypeScriptWorkerPath&&j.setWorkerOptions&&j.setWorkerOptions({customWorkerPath:g.customTypeScriptWorkerPath}),j.setDiagnosticsOptions(Object.assign(Object.assign({},j.getDiagnosticsOptions()),{noSemanticValidation:!1,diagnosticCodesToIgnore:[2354]}));const D=(e,o)=>{const i="file://"+o;j.addExtraLib(e,i);const r=t.Uri.file(i);null===t.editor.getModel(r)&&t.editor.createModel(e,"javascript",r),g.logger.log(`[ATA] Adding ${i} to runtime`,{code:e})},w=(0,a.extractTwoSlashCompilerOptions)(c);g.supportTwoslashCompilerOptions&&["javascript","typescript"].forEach((e=>t.languages.registerCompletionItemProvider(e,{triggerCharacters:["@","/","-"],provideCompletionItems:(0,a.twoslashCompletions)(c,t)})));const x=(0,p.setupTypeAcquisition)({projectName:"TypeScript Playground",typescript:c,logger:console,delegate:{receivedFile:D,progress:(e,t)=>{},started:()=>{console.log("ATA start")},finished:e=>{console.log("ATA done")}}}),P=()=>{const e=C.getModel().getValue();if(g.supportTwoslashCompilerOptions){const t=w(e);A(t)}g.acquireTypes&&x(e)};let M=!1;C.onDidChangeModelContent((e=>{M||(M=!0,setTimeout((()=>{M=!1,P()}),1e3))})),g.logger.log("[Compiler] Set compiler options: ",y),j.setCompilerOptions(y);let k=e=>{};const A=e=>{const t=Object.keys(e);t.length&&(t.forEach((t=>{y[t]==e[t]&&delete e[t]})),Object.keys(e).length&&(g.logger.log("[Compiler] Updating compiler options: ",e),y=Object.assign(Object.assign({},y),e),j.setCompilerOptions(y),k(y)))},W=()=>__awaiter(void 0,void 0,void 0,(function*(){const e=C.getModel(),t=yield I();return yield t.getEmitOutput(e.uri.toString())})),I=()=>__awaiter(void 0,void 0,void 0,(function*(){const e=yield T();return yield e(S.uri)})),E=()=>C.getModel(),F=()=>E().getValue(),L=e=>__awaiter(void 0,void 0,void 0,(function*(){const t=yield l.createDefaultMapFromCDN(y,c.version,!0,c,r.default);t.set(_.path,F()),e&&e.forEach(((e,o)=>t.set(o,e)));const o=l.createSystem(t),i=l.createVirtualCompilerHost(o,y,c);return{program:c.createProgram({rootNames:[...t.keys()],options:y,host:i.compilerHost}),system:o,host:i,fsMap:t}})),R=()=>__awaiter(void 0,void 0,void 0,(function*(){return(yield L()).program})),U=n.supportedReleases;return P(),{config:g,supportedVersions:U,editor:C,language:v,monaco:t,getWorkerProcess:I,tsvfs:l,getEmitResult:W,getRunnableJS:()=>__awaiter(void 0,void 0,void 0,(function*(){if(h)return F();const e=(yield W()).outputFiles.find((e=>e.name.endsWith(".js")||e.name.endsWith(".jsx")));return e&&e.text||""})),getDTSForCode:()=>__awaiter(void 0,void 0,void 0,(function*(){return(yield W()).outputFiles.find((e=>e.name.endsWith(".d.ts"))).text})),getDomNode:()=>C.getDomNode(),getModel:E,getText:F,setText:e=>E().setValue(e),getAST:()=>__awaiter(void 0,void 0,void 0,(function*(){const e=yield R();return e.emit(),e.getSourceFile(_.path)})),ts:c,setupTSVFS:L,createTSProgram:R,compilerDefaults:f,getCompilerOptions:()=>y,setCompilerSettings:e=>{g.logger.log("[Compiler] Setting compiler options: ",e),y=e,j.setCompilerOptions(y),k(y)},updateCompilerSetting:(e,t)=>{g.logger.log("[Compiler] Setting compiler options ",e,"to",t),y[e]=t,j.setCompilerOptions(y),k(y)},updateCompilerSettings:A,setDidUpdateCompilerSettings:e=>{k=e},lzstring:r.default,createURLQueryWithCompilerOptions:i.createURLQueryWithCompilerOptions,getTwoSlashComplierOptions:w,getTwoSlashCompilerOptions:w,languageServiceDefaults:j,filepath:_.path,addLibraryToRuntime:D}}}));